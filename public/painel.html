<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Painel do Afiliado</title>
  <style>
    body {
      background-color: #f2f2f2;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 50px;
    }
    .box {
      background: white;
      border-radius: 10px;
      padding: 30px;
      display: inline-block;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 90%;
      max-width: 500px;
    }
    .erro { color: red; }
    .sucesso { color: green; }
    input { padding: 5px; width: 90%; margin-bottom: 10px; }
    button { padding: 10px; margin-top: 10px; }
  </style>
</head>
<body>

  <div class="box">
    <h1>Painel do Afiliado</h1>
    <div id="conteudo">
      <p>Carregando...</p>
    </div>
  </div>

<script>
const token = localStorage.getItem("token");

fetch("/verificar", {
  method: "POST",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({ token }),
})
.then(res => res.json())
.then(data => {
  const c = document.getElementById("conteudo");

  if (!data.sucesso) {
    c.innerHTML = "<p class='erro'>Usuário não autenticado.</p>";
    return;
  }

  c.innerHTML = `
    <p><strong>Email:</strong> ${data.email}</p>

    <h3>Indicados:</h3>
    <p>1º Nível: ${data.nivel1} indicados → R$ ${data.ganhos1}</p>
    <p>2º Nível: ${data.nivel2} indicados → R$ ${data.ganhos2}</p>
    <p>3º Nível: ${data.nivel3} indicados → R$ ${data.ganhos3}</p>

    <h3>Total em Ganhos:</h3>
    <p style="font-size: 22px; color:green"><strong>R$ ${data.total}</strong></p>

    <h3>Seu link de Indicação:</h3>
    <input type="text" value="${data.linkIndicacao}" readonly />
    <button onclick="navigator.clipboard.writeText('${data.linkIndicacao}')">Copiar Link</button>

    <h3>Solicitar Saque</h3>
    <input type="number" id="valor" placeholder="Valor mínimo R$5,00" /><br/>
    <input type="text" id="chavePix" placeholder="Sua Chave PIX" /><br/>
    <button onclick="sacar()">Solicitar Saque</button>
    <p id="msgSaque"></p>
  `;
})
.catch(() => {
  document.getElementById("conteudo").innerHTML = "<p class='erro'>Erro ao carregar painel.</p>";
});

function sacar() {
  const valor = parseFloat(document.getElementById("valor").value);
  const chavePix = document.getElementById("chavePix").value;
  const msg = document.getElementById("msgSaque");

  if (!valor || !chavePix) {
    msg.style.color = "red";
    msg.textContent = "Preencha o valor e a chave PIX.";
    return;
  }

  fetch("/saque", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ token, valor, chavePix }),
  })
  .then(res => res.json())
  .then(data => {
    if (data.sucesso) {
      msg.style.color = "green";
      msg.textContent = data.mensagem;
    } else {
      msg.style.color = "red";
      msg.textContent = data.erro;
    }
  })
  .catch(() => {
    msg.style.color = "red";
    msg.textContent = "Erro ao solicitar saque.";
  });
}
</script>

</body>
</html>
